<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title> AscendEd - Command Center </title>
        <link rel="stylesheet" href="/static/css/command-center.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
        <script type="module" src="/static/js/progress-tracker.js"></script>
        <script src="/static/js/achievement-manager.js"></script>
        <script type="module" src="/static/js/command-center.js"></script>
        <script type="module">
            // Make functions globally accessible
            import '/static/js/dashboard.js';
            
            window.goToDashboard = function() {
                window.location.href = '/src/pages/dashboard/user-dashboard.html';
            };
        </script>
    </head>
    <body>
        <header>
            <div class="header-left">
                <i class="bi bi-cpu"></i> 
                <h1>AscendEd<span>: Tech Lab Breakout</span></h1>
            </div>
            
            <!-- Hamburger Menu Button (Mobile Only) -->
            <button class="hamburger-btn" id="hamburgerBtn" onclick="toggleMobileMenu()">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <div class="header-right" id="headerRight">
                <button class="back-btn" onclick="goToDashboard()">
                    <i class="bi bi-house"></i>
                </button>
                
                <button class="cutscene-btn" onclick="playCutscene()">
                    <i class="bi bi-play-circle"></i>
                </button>
                
                <button class="help-btn" onclick="toggleHelp()">
                    <i class="bi bi-question-circle"></i>
                </button>
            </div>

            <div class="module-nav" id="moduleNav">
                <div class="module-left">
                    <h1><i class="bi bi-command"></i> Command Center: </h1>
                </div>
                <div class="module-right">
                    <button class="module-nav-btn flowchart">
                        <i class="bi bi-diagram-3"></i>
                        FLOWBYTE
                    </button>
                    <button class="module-nav-btn networking">
                        <i class="bi bi-hdd-network"></i>
                        NETXUS
                    </button>
                    <button class="module-nav-btn ai-training">
                        <i class="bi bi-robot"></i>
                        AITRIX
                    </button>
                    <button class="module-nav-btn database">
                        <i class="bi bi-database"></i>
                        SCHEMAX
                    </button>
                    <button class="module-nav-btn programming">
                        <i class="bi bi-code-slash"></i>
                        CODEVANCE
                    </button>
                </div>
            </div>

            <!-- Mobile Menu Overlay -->
            <div class="mobile-menu-overlay" id="mobileMenuOverlay">
                <div class="mobile-menu-content">
                    <div class="mobile-nav-buttons">
                        <button class="mobile-nav-btn back-btn" onclick="goToDashboard(); closeMobileMenu();">
                            <i class="bi bi-house"></i>
                            <span>Dashboard</span>
                        </button>
                        
                        <button class="mobile-nav-btn cutscene-btn" onclick="playCutscene(); closeMobileMenu();">
                            <i class="bi bi-play-circle"></i>
                            <span>Cutscene</span>
                        </button>
                        
                        <button class="mobile-nav-btn help-btn" onclick="toggleHelp(); closeMobileMenu();">
                            <i class="bi bi-question-circle"></i>
                            <span>Help</span>
                        </button>
                    </div>
                    
                    <div class="mobile-module-nav">
                        <h2><i class="bi bi-command"></i> Game Rooms</h2>
                        <div class="mobile-module-buttons">
                            <button class="mobile-module-btn flowchart" onclick="selectRoom('flowchart'); closeMobileMenu();">
                                <i class="bi bi-diagram-3"></i>
                                <span>FLOWBYTE</span>
                            </button>
                            <button class="mobile-module-btn networking" onclick="selectRoom('networking'); closeMobileMenu();">
                                <i class="bi bi-hdd-network"></i>
                                <span>NETXUS</span>
                            </button>
                            <button class="mobile-module-btn ai-training" onclick="selectRoom('ai-training'); closeMobileMenu();">
                                <i class="bi bi-robot"></i>
                                <span>AITRIX</span>
                            </button>
                            <button class="mobile-module-btn database" onclick="selectRoom('database'); closeMobileMenu();">
                                <i class="bi bi-database"></i>
                                <span>SCHEMAX</span>
                            </button>
                            <button class="mobile-module-btn programming" onclick="selectRoom('programming'); closeMobileMenu();">
                                <i class="bi bi-code-slash"></i>
                                <span>CODEVANCE</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Help Panel -->
            <div class="help-panel" id="helpPanel">
                <div class="help-header">
                    <h3> Help & Information </h3>
                    <button class="close-help" onclick="toggleHelp()">
                        <i class="bi bi-x"></i>
                    </button>
                </div>

                <div class="help-content">
                    <h4> About Dashboard </h4>
                    <p>
                        Welcome to your AscendEd dashboard! Here you can track your progress,
                        view achievements, and continue your learning journey.
                    </p>
                    
                    <h4> Navigation </h4>
                    <ul>
                        <li> View your current level and progress </li>
                        <li> Access completed and upcoming challenges </li>
                        <li> Check your leaderboard ranking </li>
                    </ul>
                    
                    <h4> Tips </h4>
                    <ul>
                        <li> Complete daily challenges for bonus points </li>
                        <li> Share your progress with friends </li>
                        <li> Check back regularly for new content </li>
                    </ul>
                </div>
            </div>
            
        </header>

        <main id="gameDisplay" style="
            position: absolute;
            top: 120px;
            left: 0;
            width: 100%;
            height: calc(100vh - 120px);
            overflow: hidden;
            background: #1a1a2e;
        ">
            <div class="loading-screen">
                <i class="bi bi-cpu-fill"></i>
                <span>Pick a Room...</span>
            </div>
        </main>
        
        <script>
            // Mobile Menu Functions
            function toggleMobileMenu() {
                const overlay = document.getElementById('mobileMenuOverlay');
                const hamburger = document.getElementById('hamburgerBtn');
                
                if (overlay.classList.contains('active')) {
                    closeMobileMenu();
                } else {
                    openMobileMenu();
                }
            }
            
            function openMobileMenu() {
                const overlay = document.getElementById('mobileMenuOverlay');
                const hamburger = document.getElementById('hamburgerBtn');
                
                overlay.classList.add('active');
                hamburger.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent scrolling
            }
            
            function closeMobileMenu() {
                const overlay = document.getElementById('mobileMenuOverlay');
                const hamburger = document.getElementById('hamburgerBtn');
                
                overlay.classList.remove('active');
                hamburger.classList.remove('active');
                document.body.style.overflow = ''; // Restore scrolling
            }
            
            // Close menu when clicking outside content
            document.addEventListener('click', (e) => {
                const overlay = document.getElementById('mobileMenuOverlay');
                const hamburger = document.getElementById('hamburgerBtn');
                const content = document.querySelector('.mobile-menu-content');
                
                if (overlay.classList.contains('active') && 
                    !content.contains(e.target) && 
                    !hamburger.contains(e.target)) {
                    closeMobileMenu();
                }
            });
            
            // Close menu on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeMobileMenu();
                }
            });
            
            // Room selection function for mobile menu
            function selectRoom(roomType) {
                // Find the corresponding module nav button and click it
                const moduleBtn = document.querySelector(`.module-nav-btn.${roomType}`);
                if (moduleBtn) {
                    moduleBtn.click();
                }
            }
            
            // Handle direct room navigation from dashboard
            document.addEventListener('DOMContentLoaded', () => {
                const targetRoom = sessionStorage.getItem('targetRoom');
                if (targetRoom) {
                    sessionStorage.removeItem('targetRoom');
                    // Navigate to room after command center is loaded
                    setTimeout(() => {
                        if (window.commandCenter) {
                            window.commandCenter.navigateToRoom(targetRoom);
                        }
                    }, 1000);
                }
                
                // Handle window resize to close mobile menu on desktop
                window.addEventListener('resize', () => {
                    if (window.innerWidth > 768) {
                        closeMobileMenu();
                    }
                });
            });
        </script>
    </body>
</html>